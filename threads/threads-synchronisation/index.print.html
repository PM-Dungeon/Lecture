<!DOCTYPE html>
<html lang="de-DE" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.135.0">
    <meta name="generator" content="Relearn 6.4.1">
    <meta name="description" content="Motivation: Verteilter Zugriff auf gemeinsame Ressourcen public class Teaser implements Runnable { private int val = 0; public static void main(String... args) { Teaser x = new Teaser(); new Thread(x).start(); new Thread(x).start(); } private void incrVal() { &#43;&#43;val; System.out.println(Thread.currentThread().getId() &#43; &#34;: &#34; &#43; val); } public void run() { IntStream.range(0, 5).forEach(i -&gt; incrVal()); } } Demo: synchronised.Teaser Zugriff auf gemeinsame Ressourcen: Mehrseitige Synchronisierung synchronized (&lt;Object reference&gt;) { &lt;statements (synchronized)&gt; } =&gt; &#34;Mehrseitige Synchronisierung&#34;
Fallunterscheidung: Thread T1 führt synchronized-Anweisung aus:">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen">
    <meta name="twitter:description" content="Motivation: Verteilter Zugriff auf gemeinsame Ressourcen public class Teaser implements Runnable { private int val = 0; public static void main(String... args) { Teaser x = new Teaser(); new Thread(x).start(); new Thread(x).start(); } private void incrVal() { &#43;&#43;val; System.out.println(Thread.currentThread().getId() &#43; &#34;: &#34; &#43; val); } public void run() { IntStream.range(0, 5).forEach(i -&gt; incrVal()); } } Demo: synchronised.Teaser Zugriff auf gemeinsame Ressourcen: Mehrseitige Synchronisierung synchronized (&lt;Object reference&gt;) { &lt;statements (synchronized)&gt; } =&gt; &#34;Mehrseitige Synchronisierung&#34;
Fallunterscheidung: Thread T1 führt synchronized-Anweisung aus:">
    <meta property="og:url" content="https://www.hsbi.de/elearning/data/FH-Bielefeld/lm_data/lm_1661234/threads/threads-synchronisation.html">
    <meta property="og:title" content="Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen">
    <meta property="og:description" content="Motivation: Verteilter Zugriff auf gemeinsame Ressourcen public class Teaser implements Runnable { private int val = 0; public static void main(String... args) { Teaser x = new Teaser(); new Thread(x).start(); new Thread(x).start(); } private void incrVal() { &#43;&#43;val; System.out.println(Thread.currentThread().getId() &#43; &#34;: &#34; &#43; val); } public void run() { IntStream.range(0, 5).forEach(i -&gt; incrVal()); } } Demo: synchronised.Teaser Zugriff auf gemeinsame Ressourcen: Mehrseitige Synchronisierung synchronized (&lt;Object reference&gt;) { &lt;statements (synchronized)&gt; } =&gt; &#34;Mehrseitige Synchronisierung&#34;
Fallunterscheidung: Thread T1 führt synchronized-Anweisung aus:">
    <meta property="og:locale" content="de_DE">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen">
    <meta itemprop="description" content="Motivation: Verteilter Zugriff auf gemeinsame Ressourcen public class Teaser implements Runnable { private int val = 0; public static void main(String... args) { Teaser x = new Teaser(); new Thread(x).start(); new Thread(x).start(); } private void incrVal() { &#43;&#43;val; System.out.println(Thread.currentThread().getId() &#43; &#34;: &#34; &#43; val); } public void run() { IntStream.range(0, 5).forEach(i -&gt; incrVal()); } } Demo: synchronised.Teaser Zugriff auf gemeinsame Ressourcen: Mehrseitige Synchronisierung synchronized (&lt;Object reference&gt;) { &lt;statements (synchronized)&gt; } =&gt; &#34;Mehrseitige Synchronisierung&#34;
Fallunterscheidung: Thread T1 führt synchronized-Anweisung aus:">
    <meta itemprop="wordCount" content="758">
    <title>Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen</title>
    <link href="https://www.hsbi.de/elearning/data/FH-Bielefeld/lm_data/lm_1661234/threads/threads-synchronisation.html" rel="canonical" type="text/html" title="Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen">

    

    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/images/logo.png?1729954976" rel="icon" type="image/png">

    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/fontawesome-all.min.css?1729954976" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/fontawesome-all.min.css?1729954976" rel="stylesheet"></noscript>
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/nucleus.css?1729954976" rel="stylesheet">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/auto-complete.css?1729954976" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/auto-complete.css?1729954976" rel="stylesheet"></noscript>
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/perfect-scrollbar.min.css?1729954976" rel="stylesheet">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/fonts.css?1729954976" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/fonts.css?1729954976" rel="stylesheet"></noscript>
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/theme.css?1729954976" rel="stylesheet">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/theme-auto.css?1729954976" rel="stylesheet" id="R-variant-style">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/chroma-auto.css?1729954976" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/variant.css?1729954976" rel="stylesheet">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/print.css?1729954976" rel="stylesheet" media="print">
    <link href="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/css/format-print.css?1729954976" rel="stylesheet">
    <script src="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/js/variant.js?1729954976"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..\/..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/www.hsbi.de\/elearning\/data\/FH-Bielefeld\/lm_data\/lm_1661234';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.index_js_url="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/index.search.js?1729954976";
      // variant stuff
      window.variants && variants.init( [ 'auto', 'zen-light', 'zen-dark', 'relearn-bright', 'relearn-light', 'relearn-dark' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script><style type="text/css">

 
.center {
    align-content: center;
    text-align: center;
    margin: auto;
}
.alert {
    color: #ff3333;
}
.bsp {
    padding: 0.05cm;
    border-width: 0.05cm;
    border-style: solid;
    border-color: #ddd;
    background-color: #ddd;
    border-radius: 25px;
    float: right;
}
.cbox {
    padding: 0.2cm;
    border-width: 0.1cm;
    border-style: solid;
    border-color: #4070a0;
    background-color: #f2f2f2;
    margin: auto;
    width: 60%;
    text-align: center;
    overflow: auto;
}
.blueArrow {
    color: #4070a0;
    font-family: "Courier New", "Courier", monospace;
    font-weight: bold;
}
.origin {
    background-color: #ededed;
    font-size: 0.8em;
}
.showme {
    background-color: #ededed;
    font-size: 0.8em;
}


 
.tldr {
    background: #dbe4ed;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
.recap {
    
    
   margin: 4px 0px 26px 0px;
}
.bib {
    background: #dbe4ed;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
.outcomes {
    background: #d9e9d5;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
.quizzes {
    background: #d9e9d5;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
.challenges {
    background: #ebe4d6;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
.assignments {
    background: #ebe4d6;
    padding: 12px;
    margin: 4px 0px 26px 0px;
}
h1.tldr, h1.recap, h1.bib, h1.outcomes, h1.quizzes, h1.challenges, h1.assignments {
    padding: 0px;
}


 
.noJsAlert {
    padding: 20px;
    background-color: #f44336;  
    color: white;
    margin-bottom: 15px;
}


 
.embed-video-player {
    position: relative;
    padding-bottom: 56%;
    height: 0;
    overflow: hidden;
}
.youtube-player {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border:0;
}


 
#header-wrapper {
    padding:0.6rem;
}


 
#shortcuts {
    padding-top: 2.0rem;
}


 
#chapter p {
    text-align: left;
}


 
figcaption h4 {
    margin-top:-2.5rem;
}
.border1 {
    border:1px solid black;
}

 
td ul, td ol {
    margin: 0 0 1rem 0.5rem;
    padding: 0 0 0 0.5rem;
}

 
h1 { font-size:2.8rem !important;}
h2 { font-size:2.2rem; margin:1.2rem 0}
h3 { font-size:1.9rem; text-align:left !important; font-weight:400 !important;}
h4 { font-size:1.6rem}
h5 { font-size:1.3rem}
h6 { font-size:1rem}

h2 {
    width:100% !important;
    border-bottom:1px solid #5e5e5e !important;
    padding-bottom: 2px;
}
.tldr h2, .recap h2, .bib h2, .outcomes h2, .quizzes h2, .challenges h2, .assignments h2 {
    margin:0.5rem 0
}

.btn-crossreference, .btn-crossreference:hover {
    cursor: initial;
}

</style>

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/threads/threads-synchronisation.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <span class="topbar-breadcrumbs highlightable">
            Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable " tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
<h1>Synchronisation: Verteilter Zugriff auf gemeinsame Ressourcen</h1>



    



    

    <div class="box notices cstyle info">
  <div class="box-label">
    <i class="fas fa-graduation-cap"></i> TL;DR
  </div>
  <div class="box-content">
<p>Bei verteiltem Zugriff auf gemeinsame Ressourcen besteht Synchronisierungsbedarf,
insbesondere sollten nicht mehrere Threads gleichzeitig geteilte Daten modifizieren.
Dazu kommt das Problem, dass ein Thread in einer komplexen Folge von Aktionen die
Zeitscheibe verlieren kann und dann später mit veralteten Daten weiter macht.</p>
<p>Um den Zugriff auf gemeinsame Ressourcen oder den Eintritt in kritische Bereiche
zu schützen und zu synchronisieren, kann man diese Zugriffe oder Bereiche in einen
<code>synchronized</code>-Block legen. Dazu benötigt man noch ein beliebiges (gemeinsam
sichtbares) Objekt, welches als Wächter- oder Sperr-Objekt fungiert. Beim Eintritt
in den geschützten Block muss ein Thread einen Lock auf dem Sperr-Objekt erlangen.
Hat bereits ein anderer Thread den Lock, wird der neue Thread so lange blockiert,
bis der Lock wieder &quot;frei&quot; ist. Beim Eintritt in den Bereich wird dann durch den
Thread auf dem Sperr-Objekt der Lock gesetzt und beim Austritt automatisch wieder
aufgehoben. Dies nennt man auch <strong>mehrseitige Synchronisierung</strong> (mehrere Threads
&quot;stimmen&quot; sich quasi untereinander über den Zugriff auf eine Ressource ab).</p>
<p>Um auf den Eintritt eines Ereignisses oder die Erfüllung einer Bedingung zu warten,
kann man <code>wait</code> und <code>notify</code> nutzen. In einem <code>synchronized</code>-Block prüft man, ob
die Bedingung erfüllt oder ein Ereignis eingetreten ist, und falls ja arbeitet man
damit normal weiter. Falls die Bedingung nicht erfüllt ist oder das Ereignis nicht
eingetreten ist, kann man auf dem im <code>synchronized</code>-Block genutzten Sperr-Objekt
die Methode <code>wait()</code> aufrufen. Damit wird der Thread in die entsprechende Schlange
auf dem Sperr-Objekt eingereiht und blockiert. Zusätzlich wird der Lock auf dem
Sperr-Objekt freigegeben. Zum &quot;Aufwecken&quot; nutzt man an geeigneter Stelle auf dem
<strong>selben Sperr-Objekt</strong> die Methode <code>notify()</code> oder <code>notifyALl()</code> (erstere weckt
einen in der Liste des Sperr-Objekts wartenden Thread, die letztere alle). Nach
dem Aufwachen macht der Thread nach seinem <code>wait()</code> weiter. Es ist also wichtig,
dass die Bedingung, wegen der ursprünglich das <code>wait()</code> aufgerufen wurde, erneut
abgefragt wird und ggf. erneut in das <code>wait()</code> gegangen wird. Dies nennt man
<strong>einseitige Synchronisierung</strong>.</p>
<p>Es gibt darüber hinaus viele weitere Mechanismen und Probleme, die aber den Rahmen
dieser Lehrveranstaltung deutlich übersteigen. Diese werden teilweise in den
Veranstaltungen &quot;Betriebssysteme&quot; und/oder &quot;Verteilte Systeme&quot; besprochen.</p>
  </div>
</div>




    
    
    
    





    
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
        
        
            
        
    
    

    <div class="box notices cstyle info">
  <div class="box-label">
    <i class="fas fa-podcast"></i> Videos (YouTube)
  </div>
  <div class="box-content">
<ul> <li><a href='https://youtu.be/FtVaobn4NqA' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>VL Threads Synchronisation</a></li> <li><a href='https://youtu.be/SB1ngVkQdLM' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>Demo Teaser: Falscher Zugriff auf gemeinsame Ressourcen</a></li> <li><a href='https://youtu.be/YTV-oT-vmpE' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>Demo Mehrseitige Synchronisation (Sperr-Objekt, synchronisierte Methode)</a></li> <li><a href='https://youtu.be/D4B5xHqCZ-0' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>Demo Mehrseitige Synchronisation: Deadlock</a></li> <li><a href='https://youtu.be/akCl01ZAaGo' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>Demo Einseitige Synchronisation</a></li></ul>
  </div>
</div>




    
    
    
    





    
    
        
        
            
        
    
    

    <div class="box notices cstyle info">
  <div class="box-label">
    <i class="fas fa-podcast"></i> Videos (HSBI-Medienportal)
  </div>
  <div class="box-content">
<ul> <li><a href='https://www.hsbi.de/medienportal/m/08f819d3002d7658801ff15fdb14cbdba82defee0ae97d929f5c4a03eeb0e3e9b751e90f5e0fe0ac3d55a551a53065c04f505f23a6c9f41d69d504474ea28c04' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>VL Threads Synchronisation</a></li></ul>
  </div>
</div>




    
    
    
    






    
    





    

    

    
    
        
        
        
        
    
        
        
        
        
    
        
        
        
        
    
    

    <div class="box notices cstyle tip">
  <div class="box-label">
    <i class="fas fa-lightbulb"></i> Lernziele
  </div>
  <div class="box-content">
<ul> <li>(K2) Notwendigkeit zur Synchronisation</li> <li>(K2) Unterscheidung einseitige und mehrseitige Synchronisation</li> <li>(K3) Synchronisation mit <code>synchronized</code>, <code>wait</code>, <code>notify</code> und <code>notifyAll</code></li></ul>
  </div>
</div>




    <h2 id="motivation-verteilter-zugriff-auf-gemeinsame-ressourcen">Motivation: Verteilter Zugriff auf gemeinsame Ressourcen</h2>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Teaser</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> val <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String... args) {
</span></span><span style="display:flex;"><span>        Teaser x <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Teaser();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> Thread(x).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> Thread(x).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">incrVal</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">++</span>val;
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> val);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        IntStream.<span style="color:#a6e22e">range</span>(0, 5).<span style="color:#a6e22e">forEach</span>(i <span style="color:#f92672">-&gt;</span> incrVal());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<div style="text-align: right;"><span class="btn cstyle interactive default"><a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/lecture/threads/src/synchronised/Teaser.java" target="_blank"><span class="title">Demo: synchronised.Teaser</span></a></span></div>
<h2 id="zugriff-auf-gemeinsame-ressourcen-mehrseitige-synchronisierung">Zugriff auf gemeinsame Ressourcen: Mehrseitige Synchronisierung</h2>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> (<span style="color:#f92672">&lt;</span>Object reference<span style="color:#f92672">&gt;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>statements (<span style="color:#66d9ef">synchronized</span>)<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>=&gt; <span class='alert'><strong>&quot;Mehrseitige Synchronisierung&quot;</strong></span></p>
<p>Fallunterscheidung: Thread T1 führt <code>synchronized</code>-Anweisung aus:</p>
<ul>
<li>Sperre im Sperr-Objekt nicht gesetzt:
<ol>
<li>T1 setzt Sperre beim Eintritt,</li>
<li>führt den Block aus, und</li>
<li>löst Sperre beim Verlassen</li>
</ol>
</li>
<li>Sperre durch T1 gesetzt:
<ol>
<li>T1 führt den Block aus, und</li>
<li>löst Sperre beim Verlassen <strong>nicht</strong></li>
</ol>
</li>
<li>Sperre durch T2 gesetzt:
=&gt; T1 wird blockiert, bis T2 die Sperre löst</li>
</ul>
<p><em>Anmerkung</em>: Das für die Synchronisierung genutzte Objekt nennt man &quot;Wächter-Objekt&quot;
oder auch &quot;Sperr-Objekt&quot; oder auch &quot;Synchronisations-Objekt&quot;.</p>
<p>Damit könnte man den relevanten Teil der Methode <code>incrVal()</code> beispielsweise in einen
geschützten Bereich einschließen und als Sperr-Objekt das eigene Objekt (<code>this</code>) einsetzen:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">incrVal</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span> (<span style="color:#66d9ef">this</span>) { <span style="color:#f92672">++</span>val; }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<div style="text-align: right;"><span class="btn cstyle interactive default"><a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/lecture/threads/src/synchronised/ObjSync.java" target="_blank"><span class="title">Demo: synchronised.ObjSync</span></a></span></div>
<h2 id="synchronisierte-methoden">Synchronisierte Methoden</h2>
<div class='columns'>
<div class='column'>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">f</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> (<span style="color:#66d9ef">this</span>) {
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</div>
<div class='column'>
<p>... ist äquivalent zu ...</p>
</div>
<div class='column'>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">f</span>() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</div>
</div>
<p>Kurzschreibweise: Man spart das separate Wächter-Objekt und synchronisiert auf sich selbst ...</p>
<p>Die Methode <code>incrVal()</code> könnte entsprechend so umgeschrieben werden:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">incrVal</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">++</span>val;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<div style="text-align: right;"><span class="btn cstyle interactive default"><a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/lecture/threads/src/synchronised/MethodSync.java" target="_blank"><span class="title">Demo: synchronised.MethodSync</span></a></span></div>
<h2 id="probleme-bei-der-mehrseitigen-synchronisierung-deadlocks">Probleme bei der (mehrseitigen) Synchronisierung: Deadlocks</h2>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Deadlock</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">foo</span>(Deadlock other) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;%s: %s.foo() \n&#34;</span>, Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>(), name);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;%s: %s.name()\n&#34;</span>, Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>(), other.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String... args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Deadlock a <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Deadlock(<span style="color:#e6db74">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Deadlock b <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Deadlock(<span style="color:#e6db74">&#34;b&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> a.<span style="color:#a6e22e">foo</span>(b)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> b.<span style="color:#a6e22e">foo</span>(a)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Viel hilft hier nicht viel! Durch zu großzügige mehrseitige Synchronisierung
kann es passieren, dass Threads gegenseitig aufeinander warten: Thread A belegt
eine Ressource, die ein anderer Thread B haben möchte und Thread B belegt eine
Ressource, die A gerne bekommen würde. Da es dann nicht weitergeht, nennt man
diese Situation auch &quot;Deadlock&quot; (&quot;Verklemmung&quot;).</p>
<p>Im Beispiel ruft der erste Thread für das Objekt <code>a</code> die <code>foo()</code>-Methode auf und
holt sich damit den Lock auf <code>a</code>. Um die Methode beenden zu können, muss noch die
<code>getName()</code>-Methode vom Objekt <code>b</code> durch diesen ersten Thread aufgerufen werden.
Dafür muss der erste Thread den Lock auf <code>b</code> bekommen.</p>
<p>Dummerweise hat parallel der zweite Thread auf dem Objekt <code>b</code> die <code>foo()</code>-Methode
aufgerufen und sich damit den Lock auf <code>b</code> geholt. Damit muss der erste Thread so
lange warten, bis der zweite Thread den Lock auf <code>b</code> freigibt.</p>
<p>Das wird allerdings nicht passieren, da der zweite Thread zur Beendigung der
<code>foo()</code>-Methode noch <code>getName()</code> auf <code>a</code> ausführen muss und dazu den Lock auf <code>b</code>
holen, den aber aktuell der erste Thread hält.</p>
<p>Und schon geht's nicht mehr weiter :-)</p>
<div style="text-align: right;"><span class="btn cstyle interactive default"><a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/lecture/threads/src/synchronised/Deadlock.java" target="_blank"><span class="title">Demo: synchronised.Deadlock</span></a></span></div>
<h2 id="warten-auf-andere-threads-einseitige-synchronisierung">Warten auf andere Threads: Einseitige Synchronisierung</h2>
<h3 id="problem">Problem</h3>
<ul>
<li>Thread T1 wartet auf Arbeitsergebnis von T2</li>
<li>T2 ist noch nicht fertig</li>
</ul>
<h3 id="mögliche-lösungen">Mögliche Lösungen</h3>
<ol>
<li>Aktives Warten (Polling): Permanente Abfrage
<ul>
<li>Kostet unnötig Rechenzeit</li>
</ul>
</li>
<li>Schlafen mit <code>Thread.sleep()</code>
<ul>
<li>Etwas besser; aber wie lange soll man idealerweise schlafen?</li>
</ul>
</li>
<li>Warten mit <code>T2.join()</code>
<ul>
<li>Macht nur Sinn, wenn T1 auf das <em>Ende</em> von T2 wartet</li>
</ul>
</li>
<li><strong>Einseitige Synchronisierung</strong> mit <code>wait()</code> und <code>notify()</code>
<ul>
<li>Das ist DIE Lösung für das Problem :)</li>
</ul>
</li>
</ol>
<h2 id="einseitige-synchronisierung-mit-wait-und-notify">Einseitige Synchronisierung mit <em>wait</em> und <em>notify</em></h2>
<ul>
<li>
<p><span class='alert'><strong>wait</strong></span>: Warten auf Erfüllung einer Bedingung (Thread blockiert):</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> (obj) {    <span style="color:#75715e">// Geschützten Bereich betreten</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>condition) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            obj.<span style="color:#a6e22e">wait</span>(); <span style="color:#75715e">// Thread wird blockiert</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...     <span style="color:#75715e">// Condition erfüllt: Tue Deine Arbeit</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>=&gt; Bedingung nach Rückkehr von <code>wait</code> erneut prüfen!</p>
</li>
</ul>
<h3 id="eigenschaften-von-wait">Eigenschaften von <em>wait</em></h3>
<ul>
<li>Thread ruft auf Synchronisations-Objekt die Methode <code>wait</code> auf</li>
<li>Prozessor wird entzogen, Thread blockiert</li>
<li>Thread wird in interne Warteschlange des Synchronisations-Objekts eingetragen</li>
<li>Sperre auf Synchronisations-Objekt wird freigegeben</li>
</ul>
<p>=&gt; Geht nur innerhalb der <code>synchronized</code>-Anweisung für das Synchronisations-Objekt!</p>
<h2 id="einseitige-synchronisierung-mit-wait-und-notify-cnt">Einseitige Synchronisierung mit <em>wait</em> und <em>notify</em> (cnt.)</h2>
<ul>
<li>
<p><span class='alert'><strong>notify</strong></span>: Aufwecken von wartenden (blockierten) Threads:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span> (obj) {
</span></span><span style="display:flex;"><span>    obj.<span style="color:#a6e22e">notify</span>();       <span style="color:#75715e">// einen Thread &#34;in&#34; obj aufwecken</span>
</span></span><span style="display:flex;"><span>    obj.<span style="color:#a6e22e">notifyAll</span>();    <span style="color:#75715e">// alle Threads &#34;in&#34; obj wecken</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
</ul>
<h3 id="eigenschaften-von-notify-bzw-notifyall">Eigenschaften von <em>notify</em> bzw. <em>notifyAll</em></h3>
<ul>
<li>Thread ruft auf einem Synchronisations-Objekt die Methode <code>notify</code>
oder <code>notifyAll</code> auf</li>
<li>Falls Thread(s) in Warteschlange des Objekts vorhanden, dann
<ul>
<li><code>notify</code>: Ein <em>zufälliger</em> Thread wird aus Warteschlange entfernt und
in den Zustand &quot;ausführungsbereit&quot; versetzt</li>
<li><code>notifyAll</code>: Alle Threads werden aus Warteschlange entfernt und in
den Zustand &quot;ausführungsbereit&quot; versetzt</li>
</ul>
</li>
</ul>
<p>=&gt; Geht nur innerhalb der <code>synchronized</code>-Anweisung für das Synchronisations-Objekt!</p>
<div style="text-align: right;"><span class="btn cstyle interactive default"><a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/lecture/threads/src/synchronised/Staffel.java" target="_blank"><span class="title">Demo: synchronised.Staffel</span></a></span></div>
<h2 id="wrap-up">Wrap-Up</h2>
<p>Synchronisierungsbedarf bei verteiltem Zugriff auf gemeinsame Ressourcen:</p>
<ul>
<li>
<p>Vorsicht mit konkurrierendem Ressourcenzugriff:
Synchronisieren mit <code>synchronized</code> =&gt; <strong>Mehrseitige Synchronisierung</strong></p>
</li>
<li>
<p>Warten auf Ereignisse mit <code>wait</code> und <code>notify</code>/<code>notifyAll</code> =&gt; <strong>Einseitige Synchronisierung</strong></p>
</li>
</ul>


    



    
    
        
        
        
            
        
    
    

    <div class="box notices cstyle tip">
  <div class="box-label">
    <i class="fas fa-user-check"></i> Quizzes
  </div>
  <div class="box-content">
<ul> <li><a href='https://www.hsbi.de/elearning/goto.php?target=tst_1106530&client_id=FH-Bielefeld' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>Quiz Threads Synchronisation (ILIAS)</a></li></ul>
  </div>
</div>



    



    

    <div class="box notices cstyle note">
  <div class="box-label">
    <i class="fas fa-puzzle-piece"></i> Challenges
  </div>
  <div class="box-content">
<p><strong>Hamster-Welt</strong></p>
<p>In den <a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/tree/master/lecture/threads/src/challenges/threads" rel="external" target="_blank">Vorgaben</a>
finden Sie eine Modellierung für eine Hamsterwelt.</p>
<p>Es gibt rote und blaue Hamster, die sich unabhängig von einander bewegen können. Es gibt einen Tunnel, den die Hamster betreten
und durchqueren können. In der Vorgabe ist ein kleines Hauptprogramm enthalten, welches einige Hamster anlegt und herumlaufen
lässt.</p>
<p><strong>Teil I: Stau im Tunnel</strong></p>
<p>Die Hamster sind sehr neugierig und wollen gern durch den Tunnel gehen, um die Höhle auf der anderen Seite zu erkunden. Leider
mussten sie feststellen, dass immer nur ein Hamster zu einem Zeitpunkt im Tunnel sein darf, sonst wird die Luft zu knapp.</p>
<p>Ergänzen Sie die Vorgaben, so dass sich immer nur ein paralleler Hamster (egal welcher Farbe) im Tunnel aufhalten kann. Wenn ein
Hamster in den Tunnel will, aber nicht hinein kann, dann soll er am Eingang warten, also nicht noch einmal in seiner Höhle
herumlaufen. (Das passiert eigentlich automatisch, wenn Sie alles richtig machen.)</p>
<p><strong>Teil II: Schlaue Hamster</strong></p>
<p>Die Hamster sind schlau und haben bemerkt, dass die Einschränkung aus der letzten Aufgabe zu stark war. Sie überleben auch, wenn
sich beliebig viele blaue Hamster oder nur genau ein roter Hamster im Tunnel aufhalten.</p>
<p>Erweitern Sie die Implementierung aus der letzten Aufgabe, so dass folgende Bedingungen eingehalten werden:</p>
<ul>
<li>
<p>Es dürfen sich beliebig viele blaue Hamster gleichzeitig im Tunnel befinden.</p>
<p>Das bedeutet, dass in diesem Fall zwar weitere blaue Hamster den Tunnel betreten dürfen, aber kein roter Hamster in den Tunnel
hinein darf.</p>
</li>
<li>
<p>Wenn sich ein roter Hamster im Tunnel aufhält, dürfen keine anderen Hamster (unabhängig von deren Farbe) den Tunnel betreten.</p>
</li>
</ul>
  </div>
</div>



    




    




    
    
        
        

        
            
            
            
            
            

            
            
                
                    
                
            
            
            
            
            
            

            
            
                
            
            
                
                
                    
                
                
            
            
            
        
    
        
        

        
            
            
            
            
            

            
            
                
                    
                
            
            
            
            
            
            

            
            
                
            
            
                
                
                
            
            
                
            
            
        
    
    

    <div class="box notices cstyle info">
  <div class="box-label">
    <i class="fas fa-book-reader"></i> Quellen
  </div>
  <div class="box-content">
<ul> <li id='id_Boles2008'>[Boles2008] <a href='http://www.boles.de/hamster/band3.html' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'><strong>Parallele Programmierung spielend gelernt mit dem Java-Hamster-Modell</strong></a><br>Boles, D., Vieweg+Teubne, 2008. ISBN <a href='https://fhb-bielefeld.digibib.net/openurl?isbn=978-3-8351-0229-3' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'>978-3-8351-0229-3</a>.</li> <li id='id_Java-SE-Tutorial'>[Java-SE-Tutorial] <a href='https://docs.oracle.com/javase/tutorial/' class='icon reading' target='_blank' rel='nofollow noopener noreferrer'><strong>The Java Tutorials</strong></a><br>Oracle Corporation, 2022.<br><em>Trail: Essential Java Classes, Lesson: Concurrency</em></li></ul>
  </div>
</div>






<footer class="footline"><div style="color: darkgray; font-size: small;">
<p style="margin-left: 4rem; margin-right: 4rem; margin-top: 6rem;">
<!-- https://creativecommons.org/choose/ -->
<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0;margin:0;display:inline;" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
Unless otherwise noted, <a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture">this work</a> by <a xmlns:cc="https://creativecommons.org/ns#" href="https://github.com/cagix" property="cc:attributionName" rel="cc:attributionURL">Carsten Gips</a> and <a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/graphs/contributors">contributors</a> is licensed under <a rel="license" href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/LICENSE.md">CC BY-SA 4.0</a>.
See the <a href="https://github.com/Programmiermethoden-CampusMinden/Prog2-Lecture/blob/master/CREDITS.md">credits</a> for a detailed list of contributing projects.

</p>
</div>

</footer>
</article>

        </div>
      </main>
    </div>
    <script src="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/js/clipboard.min.js?1729954976" defer></script>
    <script src="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/js/perfect-scrollbar.min.js?1729954976" defer></script>
    <script>
      function useMathJax( config ){
        window.MathJax = Object.assign( window.MathJax || {}, {
          tex: {
            inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
            displayMath: [['\\[', '\\]'], ['$$', '$$']], 
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/js/mathjax/tex-mml-chtml.js?1729954976"></script>
    <script src="/elearning/data/FH-Bielefeld/lm_data/lm_1661234/js/theme.js?1729954976" defer></script>
  </body>
</html>
