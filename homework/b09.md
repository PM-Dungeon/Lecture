---
archetype: assignment
title: "Blatt 09: DevDungeon (Refactoring, Smells)"
author: "Carsten Gips (HSBI)"
points: "1 Punkt"

hidden: true
---

## DevDungeon: Illusion Riddle

Klonen Sie das Projekt [DevDungeon] und laden Sie es in Ihrer IDE als Gradle-Projekt.
Betrachten Sie das Sub-Projekt "devDungeon". Dies ist ein von einem Studierenden ([\@Flamtky])
erstelltes Spiel mit mehreren Leveln, in denen Sie spielerisch verschiedene Aufgaben *in-game*
und *ex-game* lösen müssen.

### A09.1: DevDungeon: Lösen des Illusion Riddle (20%)

Starten Sie den DevDungeon mit `./gradlew devDungeon:runDevDungeon`. Spielen Sie sich für
diese Aufgabe durch das **dritte Level** ("Illusion Riddle")[^1].

In diesem Level gibt es mehrere Räume, die durch Teleporter (statt Türen) miteinander
verbunden sind. Beim Betreten dieser nur schwer sichtbaren Bodenkacheln werden Sie in den
nächsten Raum transportiert. Während dieser Mechanismus deterministisch ist, gibt es
zusätzlich eine neue Monster-Art, die Sie mit fischähnlich aussehenden Geschossen angreift und
bei einem Treffer in einen zufälligen Raum transportiert.

Leider ist durch den starken Fog-of-War kaum etwas zu sehen. Auch die vielen Fackeln
verbessern die Sicht nicht wirklich. Können Sie mit diesen Fackeln interagieren?

Ziel ist es, den Weg zum letzten Raum des Levels zu finden und den dort wartenden Boss-Gegner
zu besiegen.

*Tipp*: Es könnte hilfreich sein, sich eine Skizze der Räume anzufertigen.

*Tipp*: Es könnte in einem bestimmten Raum hilfreich sein, mehrfach im Kreis zu laufen ...

*Tipp*: Eine Code-Analyse könnte helfen. Vielleicht können Sie durch Anpassungen im Code die
Sicht verbessern oder die Gesundheit Ihres Helden verbessern oder die Teleportationsgeschosse
unschädlich machen? Streng genommen ist das natürlich *cheaten*, aber da Sie ja Code lesen und
anpassen üben, können wir darüber hinwegsehen. Erklären Sie im Praktikum, welche Änderungen
Sie wo und warum vorgenommen haben und was das bewirkt.

**Hinweis**: Aktuell ist das Projekt DevDungeon an einigen Stellen noch *Work-in-Progress*,
beispielsweise fehlt häufig noch die Javadoc. Alle Gradle-Tasks, die von Checkstyle-Tasks
abhängen (`checkstyleMain`, `check`, `build`, ...) werden deshalb fehlschlagen. Sie können den
DevDungeon aber wie oben beschrieben mit `./gradlew devDungeon:runDevDungeon` (bzw. über den
Task `devDungeon:runDevDungeon` aus der IDE heraus) starten.

[**WICHTIG**: Achten Sie bitte darauf, dass im Projektpfad **keine Leerzeichen** und keine
Sonderzeichen (Umlaute o.ä.) vorkommen! Dies kann zu seltsamen Fehler führen. Bitte auch
darauf achten, dass Sie als JDK ein **Java SE 21 (LTS)** verwenden.]{.alert}

### A09.2: DevDungeon: Refactoring der Klasse level.devlevel.IllusionRiddleLevel (40%)

Analysieren Sie die Klasse `IllusionRiddleLevel` im Package `level.devlevel`, insbesondere die
beiden Methoden `IllusionRiddleLevel#onTick` und `IllusionRiddleLevel#lightTorch`.

1.  Welche *Bad Smells* können Sie hier identifizieren?

2.  Beheben Sie die Smells durch die *schrittweise Anwendung*[^2] von den aus der Vorlesung
    bekannten Refactoring-Methoden. Wenden Sie dabei *mindestens* die unten genannten Methoden
    an:

    -   Extract Method/Class
    -   Move Method/Field
    -   Encapsulate Method/Field
    -   Pull Up oder Push Down

    Ergänzend zu der Übersicht aus der Vorlesung finden sie unter [Refactoring Guru] eine
    erweiterte Darstellung gängiger Refactoring-Techniken.

*Tipp*: Schauen Sie schlechter Namensgebung, nach redundantem Code, nach übermäßig komplexer
Logik, nach Code/Logik in der falschen Klasse (am falschen Ort), nach übermäßig vielen
Parametern, nach fehlendem Javadoc, ....

## A09.3: Refactoring im Bike-Shop (40%)

Forken Sie das ["Cycle Chronicles"]-Repo und erzeugen Sie sich eine lokale Arbeitskopie von
Ihrem Fork.

Bearbeiten Sie die folgenden Teilaufgaben jeweils in einem eigenen Branch. Pushen Sie Ihre
Änderungen in Ihren Fork zurück und erstellen Sie dort je einen Pull-Request auf **Ihren**
eigenen `master`-Branch.

**Bitte lassen Sie die Pull-Requests bis zur Vorstellung im Praktikum offen.**

Achten Sie darauf, alle Schritte nachvollziehbar in Ihrer Arbeitskopie per Git-Commit
festzuhalten. Demonstrieren Sie im Praktikum, wie Sie mit den Pull-Requests arbeiten.

Ihr Code soll einheitlich formatiert und dokumentiert sein. Sie können beides prüfen:
`./gradlew spotlessCheck` für die Formatierung und `./gradlew checkstyleMain` für die
Dokumentation[^3] mit Javadoc.[^4] Während Sie die Dokumentation bei Fehlern manuell anpassen
müssen (siehe Lektion ["Javadoc"]), können Sie mit `./gradlew spotlessApply` den Code
automatisch formatieren lassen - tun Sie das am besten vor jedem Commit.

[^1]: Das dritte richtige Level, also das dritte Level *nach* dem Demo-Level. Oder eben das
    vierte Level, wenn man das Demo-Level mitzählt :-)

[^2]: Machen Sie pro Refactoring-Schritt einen Commit, und halten Sie alle Commits in einem
    Pull-Request fest. An diesem können Sie im Praktikum Ihr Vorgehen vorstellen.

[^3]: zumindest für den syntaktischen Aspekt ...

[^4]: Sie können auch beides zusammen per `./gradlew check` prüfen lassen.

  [DevDungeon]: https://github.com/Dungeon-CampusMinden/dev-dungeon
  [\@Flamtky]: https://github.com/Flamtky
  [Refactoring Guru]: https://refactoring.guru/refactoring/techniques
  ["Cycle Chronicles"]: https://github.com/Programmiermethoden-CampusMinden/prog2_ybel_cyclechronicles
  ["Javadoc"]: ../lecture/coding/javadoc.md
